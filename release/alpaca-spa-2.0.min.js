Router=function(){"use strict";var obj={};obj.AlpacaName='Alpaca.';obj.Alpaca={};obj.ModulePostfix='Module';obj.ControllerPostfix='Controller';obj.ActionPostfix='Action';obj.DefaultModule='alpaca';obj.DefaultController='alpaca';obj.DefaultAction='index';obj.Module=null;obj.Controller=null;obj.Action=null;obj.ModuleName=null;obj.ControllerName=null;obj.ActionName=null;obj.ModuleFullName=null;obj.ControllerFullName=null;obj.ActionFullName=null;obj.InHash=null;obj.Params=new Array();obj.getParams=function(){};obj.parser=function(inHash){if(!inHash){inHash=""}if(inHash.indexOf("?")!=-1){inHash=inHash.slice(0,inHash.indexOf("?"))}var segments=new Array();segments=inHash.split("/");if(!segments[3]){segments.splice(1,0,this.DefaultModule)}if(!segments[3]){segments.splice(2,0,this.DefaultController)}if(!segments[3]){segments.splice(3,0,this.DefaultAction)}this.Params=segments.slice(4);if(this.InHash==inHash){return null}this.InHash=inHash;this.Module=segments[1];this.ModuleName=this.Module+this.ModulePostfix;this.ModuleName=this.ModuleName.replace(/(\w)/,function(v){return v.toUpperCase()});this.ModuleFullName=this.AlpacaName+this.ModuleName;this.Controller=segments[2];this.ControllerName=this.Controller+this.ControllerPostfix;this.ControllerName=this.ControllerName.replace(/(\w)/,function(v){return v.toUpperCase()});this.ControllerFullName=this.ModuleFullName+"."+this.ControllerName;this.Action=segments[3];this.ActionName=this.Action+this.ActionPostfix;this.ActionFullName=this.ControllerFullName+"."+this.ActionName;console.log(this.ModuleName,this.ControllerName,this.ActionName);return this};obj.check=function(router){var actionName='';var alpacaController=this.AlpacaName+"AlpacaModule.AlpacaController";if(!eval(router.ModuleFullName)){actionName=alpacaController+".moduleNotFoundAction"}else if(!eval(router.ControllerFullName)){actionName=alpacaController+".controllerNotFoundAction"}else if(!eval(router.ActionFullName)){actionName=alpacaController+".actionNotFoundAction"}else{actionName=router.ActionFullName}return actionName};obj.init=function(){var moduleResult=undefined;if(eval(this.ModuleFullName)&&eval(this.ModuleFullName+".init")){moduleResult=eval(this.ModuleFullName+".init()")}if(moduleResult!==undefined){return moduleResult}var controllerResult=undefined;if(eval(this.ModuleFullName)&&eval(this.ControllerFullName)&&eval(this.ControllerFullName+".init")){controllerResult=eval(this.ControllerFullName+".init()")}if(controllerResult!==undefined){return controllerResult}return undefined};obj.release=function(){if(eval(this.ModuleFullName)&&eval(this.ControllerFullName)&&eval(this.ControllerFullName+".release")){eval(this.ControllerFullName+".release()")}if(eval(this.ModuleFullName)&&eval(this.ModuleFullName+".release")){eval(this.ModuleFullName+".release()")}};obj.doAction=function(actionName){var initResult=this.init();if(initResult!==undefined){return}if(!actionName){return}var result=eval(actionName+"()");if(!result){return}if(result){result.display()}this.release();return result};obj.run=function(inHash){var router=this.parser(inHash);var runAction=this.check(router);var result=this.doAction(runAction);return result};return obj};ViewModel=function(){"use strict";var obj={};obj.DefaultViewCaptureTo="#content";obj.DefaultLayoutCaptureTo="body";obj.TemplatePostfix='html';obj.Alpaca={};obj.create=function(){var view={};view.Alpaca=this.Alpaca;view.Name=(function(){if(!view.Alpaca.Router){return''}return view.Alpaca.Router.Action}());view.Template=(function(){if(!view.Alpaca.Router){return''}var path=view.Alpaca.Config['baseUrl'];path+=view.Alpaca.Router.Module;path+="/view/"+view.Alpaca.Router.Controller+"/";path+=view.Alpaca.Router.Action+".";path+=view.Alpaca.ViewModel.TemplatePostfix;return path}());view.CaptureTo=this.DefaultViewCaptureTo;view.IsUseLayout=false;view.IsFinal=false;view.Data={};view.Layout=null;view.LayoutData={};view.PartData={};view.Children=[];view.ChildData={};view.loadTemplate=function(url){var htmlObj=view.Alpaca.$.ajax({type:"get",url:url,async:false});return htmlObj.responseText};view.loadData=function(tpl,data){var interText=view.Alpaca.DoT.template(tpl);return interText(data)};view.show=function(captureTo,html){view.Alpaca.$(captureTo).html(html);this.onLoad();return this};view.LoadEvent=[];view.ReadyEvent=[];view.onLoad=function(){if(this.LoadEvent){for(var index in this.LoadEvent){this.LoadEvent[index](this)}}this.onReady();return this};view.onReady=function(){if(this.ReadyEvent){for(var index in this.ReadyEvent){this.ReadyEvent[index](this)}}return this};view.load=function(func){this.LoadEvent.push(func);return this};view.ready=function(func){this.ReadyEvent.push(func);return this};view.setData=function(data,isReset){if(!this.Data){this.Data={}}if(isReset){this.Data=data}else{for(var i in data){this.Data[i]=data[i]}}return this};view.setCaptureTo=function(captureTo){this.CaptureTo=captureTo;return this};view.setTemplate=function(template){this.Template=template;return this};view.setFinal=function(value){this.Final=Boolean(value);return this};view.setLayout=function(layout){this.Layout=layout;this.Layout.addChild(this);this.IsUseLayout=true;return this};view.setUseLayout=function(value){this.UseLayout=Boolean(value);if(value&&!this.Layout){this.setLayout(view.Alpaca.ViewModel.layout())}return this};view.setLayoutData=function(data){if(!this.LayoutData){this.LayoutData={}}for(var i in data){this.LayoutData[i]=data[i]}return this};view.addChild=function(child,captureTo){if(captureTo){child.setCaptureTo(captureTo)}this.Children.push(child);return this};view.setPartData=function(partData){if(!this.PartData){this.PartData={}}for(var name in partData){var data=partData[name];if(!this.PartData[name]){this.PartData[name]={}}for(var i in data){this.PartData[name][i]=data[i]}}return this};view.setChildData=function(partData){if(!this.ChildData){this.ChildData={}}for(var name in partData){var data=partData[name];if(!this.ChildData[name]){this.ChildData[name]={}}for(var i in data){this.ChildData[name][i]=data[i]}}return this};view.hasChildren=function(){return(0<(this.Children).length)};view.childRender=function(view){if(view.hasChildren){for(var index in view.Children){if(view.ChildData[view.Children[index].Name]){view.Children[index].setData(view.ChildData[view.Children[index].Name])}view.Children[index].render()}}};view.render=function(){this.load(this.childRender);var tpl=this.loadTemplate(this.Template);var html=this.loadData(tpl,this.Data);var show=this.show(this.CaptureTo,html);return html};view.display=function(){if(this.Layout&&this.IsUseLayout){for(var index in this.LayoutData){this.Layout.Data[index]=this.LayoutData[index]}for(var name in this.PartData){var data={};data[name]=this.PartData[name];this.Layout.setChildData(data)}this.Layout.render()}else{this.render()}};return view};obj.view=function(option){var view=obj.create();if(!option){option={}}if(option['data']){view.setData(option['data'])}if(option['name']){view.Name=option['name']}if(option['to']){view.setCaptureTo(option['to'])}if(option['from']){view.loadTemplate=function(){return obj.Alpaca.$(option['from']).html()};view.setTemplate('')}else if(option['template']&&!option['notFormat']){var segments=option['template'].split("/");if(segments[0]){segments.splice(0,0,'')}if(!segments[3]){segments.splice(1,0,obj.Alpaca.Router.Module)}if(!segments[3]){segments.splice(2,0,obj.Alpaca.Router.Controller)}if(!segments[3]){segments.splice(3,0,obj.Alpaca.Router.Action)}var path=obj.Alpaca.Config['baseUrl'];path+=segments[1];path+="/view/"+segments[2]+"/";path+=segments[3]+".";path+=obj.Alpaca.ViewModel.TemplatePostfix;view.setTemplate(path)}else if(option['template']){view.setTemplate(option['template'])}return view};obj.layout=function(option){if(!option){option={}}option['notFormat']=true;if(!option['to']){option['to']=obj.Alpaca.ViewModel.DefaultLayoutCaptureTo}if(!option['name']){option['name']='layout'}if(!option['template']){if(!obj.Alpaca.Router){return''}var path=obj.Alpaca.Config['baseUrl'];path+=obj.Alpaca.Router.Module;path+="/view/layout/";path+=option['name'];path+=".";path+=obj.Alpaca.ViewModel.TemplatePostfix;option['template']=path}else{option['template']+="."+obj.Alpaca.ViewModel.TemplatePostfix}var layout=obj.view(option);return layout};obj.part=function(option){if(!option){option={}}option['notFormat']=true;if(!option['name']){option['name']='part'}if(!option['to']){option['to']="#"+option['name']}if(!option['template']){if(!obj.Alpaca.Router){return''}var path=obj.Alpaca.Config['baseUrl'];path+=obj.Alpaca.Router.Module;path+="/view/layout/part/";path+=option['name'];path+=".";path+=obj.Alpaca.ViewModel.TemplatePostfix;option['template']=path}else{option['template']+="."+obj.Alpaca.ViewModel.TemplatePostfix}var part=obj.view(option);return part};return obj}();(function(){"use strict";var doT={name:"doT",version:"1.1.1",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,evaluateSpa:/<\?spa \s*([\s\S]+?(\}?)+) \s*\?>/g,interpolateSpa:/<\?spa echo ([\s\S]+?) \?>/g,encodeSpa:/\{\{!([\s\S]+?)\}\}/g,useSpa:/\{\{#([\s\S]+?)\}\}/g,useParamsSpa:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,defineSpa:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParamsSpa:/^\s*([\w$]+):([\s\S]+)/,conditionalSpa:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterateSpa:/<\?spa \s*foreach\(\s*([\s\S]+?)\s*as\s*([\w$]+)\s*(?:=>\s*([\w$]+))?\s*\)(|:) \s*\?>/g,endIterate:/<\?spa \s*endForeach(|;) \s*\?>/g,for:/<\?spa for\(\s*var\s*([\s\S]+?)\s*in\s*([\s\S]+?)\s*\) \s*\?>/g,endFor:/<\?spa \s*endFor(|;) \s*\?>/g,varname:"it",strip:true,append:true,selfcontained:false,doNotSkipEncoded:false},template:undefined,compile:undefined,log:true},_globals;doT.encodeHTMLSource=function(doNotSkipEncoded){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=doNotSkipEncoded?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(code){return code?code.toString().replace(matchHTML,function(m){return encodeHTMLRules[m]||m}):""}};_globals=(function(){return this||(0,eval)("this")}());if(typeof module!=="undefined"&&module.exports){module.exports=doT}else if(typeof define==="function"&&define.amd){define(function(){return doT})}else{_globals.doT=doT}var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;function resolveDefs(c,block,def){return((typeof block==="string")?block:block.toString()).replace((c.define||c.defineSpa)||skip,function(m,code,assign,value){if(code.indexOf("def.")===0){code=code.substring(4)}if(!(code in def)){if(assign===":"){if(c.defineParams)value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v}});if(c.defineParamsSpa)value.replace(c.defineParamsSpa,function(m,param,v){def[code]={arg:param,text:v}});if(!(code in def))def[code]=value}else{new Function("def","def['"+code+"']="+value)(def)}}return""}).replace((c.use||c.useSpa)||skip,function(m,code){if(c.useParams)code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");def.__exp=def.__exp||{};def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2");return s+"def.__exp['"+rw+"']"}});if(c.useParamsSpa)code=code.replace(c.useParamsSpa,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");def.__exp=def.__exp||{};def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2");return s+"def.__exp['"+rw+"']"}});var v=new Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v})}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var cse=c.append?startend.append:startend.split,needhtmlencode,sid=0,indv,str=((c.use||c.useSpa)||(c.define||c.defineSpa))?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(m,code){needhtmlencode=true;return cse.startencode+unescape(code)+cse.end}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?(code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='"):(code?"';if("+unescape(code)+"){out+='":"';}out+='")}).replace(c.iterate||skip,function(m,iterate,vname,iname){if(!iterate)return"';} } out+='";sid+=1;indv=iname||"i"+sid;iterate=unescape(iterate);return"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='"}).replace(c.interpolateSpa||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encodeSpa||skip,function(m,code){needhtmlencode=true;return cse.startencode+unescape(code)+cse.end}).replace(c.conditionalSpa||skip,function(m,elsecase,code){return elsecase?(code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='"):(code?"';if("+unescape(code)+"){out+='":"';}out+='")}).replace(c.iterateSpa||skip,function(m,iterate,iname,vname){if(!iterate)return"';} } out+='";sid+=1;indv=iname||"i"+sid;iterate=unescape(iterate);return"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"}).replace(c.evaluateSpa||skip,function(m,code){return"';"+unescape(code)+"out+='"}).replace(c.endIterate||skip,function(){return"';} } out+='"}).replace(c.for||skip,function(m,key,iterate){return"';for(var "+key+" in "+iterate+"){;out+='"}).replace(c.endFor||skip,function(){return"'; } out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,'\\t').replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,'$1').replace(/\+''/g,"");if(needhtmlencode){if(!c.selfcontained&&_globals&&!_globals._encodeHTML)_globals._encodeHTML=doT.encodeHTMLSource(c.doNotSkipEncoded);str="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(c.doNotSkipEncoded||'')+"));"+str}try{return new Function(c.varname,str)}catch(e){if(typeof console!=="undefined")console.log("Could not create a template function: "+str);throw e;}};doT.compile=function(tmpl,def){return doT.template(tmpl,null,def)}}());Alpaca=function(){"use strict";var obj={};obj.Version={version:'2.0.0',note:'update view and router.'};obj.Config={baseUrl:'/'};obj.$=$;obj.DoT=doT;obj.NewRouter=Router;obj.Router=null;obj.ViewModel=ViewModel;obj.ViewModel.Alpaca=obj;obj.View=function(option){var view=obj.ViewModel.view(option);return view};obj.Layout=function(option){var layout=obj.ViewModel.layout(option);return layout};obj.Part=function(option){var part=obj.ViewModel.part(option);return part};obj.HashChange=[];obj.isChangeHash=undefined;obj.run=function(runHash){var nowHash=window.location.hash;if(!nowHash){nowHash=''}if(!runHash){runHash=''}if(runHash!=''&&nowHash==''){this.forward(runHash)}else{this.forward(nowHash)}return true};obj.forward=function(inHash){this.Router=this.NewRouter();var routerResult=this.Router.run(inHash);if(routerResult==false||!routerResult){this.Router.InHash=null;return false}var isSetHash=inHash&&(routerResult.CaptureTo==Alpaca.ViewModel.DefaultLayoutCaptureTo||(routerResult.IsUseLayout==true&&routerResult.Layout.CaptureTo==Alpaca.ViewModel.DefaultLayoutCaptureTo));if(isSetHash||this.isChangeHash===true){window.onhashchange=null;window.location.hash=inHash;obj.onHashChange();setTimeout(function(){window.onhashchange=obj.changeHash},50)}this.Router.InHash=null;return true};obj.changeHash=function(){obj.forward(window.location.hash);obj.onHashChange()};obj.onHashChange=function(){for(var index in this.HashChange){this.HashChange[index]()}};obj.addHashChangeEvent=function(func){this['HashChange'].push(func)};window.onhashchange=obj.changeHash;obj.reName=function(){return Alpaca};obj.reNameJQuery=function(jquery){obj.$=jquery};obj.sleep=function(time){for(var t=Date.now();Date.now()-t<=time;){}};return obj}();Alpaca.AlpacaModule={AlpacaController:{actionNotFoundAction:function(){alert("The action is not found !")},controllerNotFoundAction:function(){alert("The controller is not found !")},moduleNotFoundAction:function(){alert("The module is not found !")},indexAction:function(){document.write('Welcome use Alpaca-spa 2.0 !')}}};View=function(data){return Alpaca.View(data)};